services:
  nginx:
    container_name: demo_production_nginx
    env_file:
      - .env
      - .production_env

  host:
    container_name: demo_production_host
    image: docker.ikari.fi/demo_build_host:${BUILD_TAG}
    env_file:
      - .env
      - .production_env
    secrets:
      - HOST_MASTER_KEY
    volumes:
      - ./host-service/docker/webapp.conf:/etc/nginx/sites-enabled/webapp.conf
      - ./host-service/docker/webapp_env.conf:/etc/nginx/main.d/webapp_env.conf

  db:
    container_name: demo_production_db
    env_file:
      - .env
      - .production_env
    secrets:
      - POSTGRES_PASSWORD
      - POSTGRES_USER

  adminer:
    container_name: demo_production_adminer
    env_file:
      - .env
      - .production_env

secrets:
  POSTGRES_PASSWORD:
    file: .production_secrets/POSTGRES_PASSWORD
  POSTGRES_USER:
    file: .production_secrets/POSTGRES_USER
  HOST_MASTER_KEY:
    file: .production_secrets/HOST_MASTER_KEY
